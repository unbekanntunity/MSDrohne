#:kivy 2.0.0
#:import get_color_from_hex kivy.utils.get_color_from_hex
#:import MapSource kivy_garden.mapview.MapSource

<BouncingPoints>:

<SupportExpansionContent>:
    adaptive_height: True
    padding: 10
    MDLabel:
        adaptive_height: True
        text: root.answer
<LoadingAnimation>:
    Image:
        id: server_img
        source:'./data/res/server.png'
        pos_hint: {'center_x':.5, 'center_y': .4}
        size_hint: .4, .4
    Image:
        id: glass_img
        source:'./data/res/glass.png'
        pos_hint: {'center_x': .55, 'center_y': .5}
        size_hint: .1, .1
    BouncingPoints:
        id: bouncing_p
        size_hint_y: .2
        size: 10, 10
        spacing_x: 50

<CustomSnackbar>
    MDIconButton:
        pos_hint: {'center_y': .5}
        icon: root.icon

    MDLabel:
        id: text_bar
        size_hint_y: None
        height: self.texture_size[1]
        text: app.bind_text(self, root.text)
        font_size: root.font_size
        theme_text_color: 'Custom'
        text_color: get_color_from_hex('ffffff')
        shorten: True
        shorten_from: 'right'
        pos_hint: {'center_y': .5}

<MenuListItem>:
    IconLeftWidget:
        icon: root.left_icon

<LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: app.bind_text(self, 'Cancel')
                on_release: root.cancel()
            Button:
                text: app.bind_text(self, 'Load')
                on_release: root.load(filechooser.path, filechooser.selection)

<WaypointArea>:
    canvas.before:
		Color:
			rgba: .5, .5, .5, .5
		Rectangle:
			pos: self.pos
			size: self.size
    MDCard:
        id: waypoint_card
        size_hint: (.5, .75)
        style: 'outlined'
        line_color: (0.2, 0.5, 0.2, 0.8)
        ScrollView:
            MDBoxLayout:
                size_hint_y: None
                height: dp(700)
                orientation: 'vertical'
                padding: 30
                spacing: 30
                MDLabel:
                    adaptive_height: True
                    halign: 'center'
                    text: root.title
                RelativeLayout:
                    FitImage:
                        id: image
                        source: './data/res/example_landscape.jpg'
                    MDIconButton:
                        size_hint: .2, .15
                        pos_hint: {'x': .8, 'y': .8}
                        icon: 'pencil-outline'
                        on_release: root.show_bottom_sheet()
                MDTextField:
                    id: name_field
                    mode: "rectangle"
                    hint_text: 'Name'
                    required: True
                    helper_text_mode: 'on_error'
                NumericTextInput:
                    id: altitude_field
                    mode: "rectangle"
                    required: True
                    hint_text: 'Altitude'
                    helper_text_mode: 'on_error'
                MDTextField:
                    id: latitude_field
                    mode: "rectangle"
                    required: True
                    hint_text: 'Latitude'
                    helper_text_mode: 'on_error'
                MDTextField:
                    id: longitude_field
                    mode: "rectangle"
                    required: True
                    hint_text: 'Longitude'
                    helper_text_mode: 'on_error'
                MDBoxLayout:
                    adaptive_height: True
                    spacing: 10
                    MDRectangleFlatButton:
                        text: app.bind_text(self, 'Discard')
                        text_color: 0, 0, 1, 1
                        line_color: 1, .2, .7, 1
                        theme_icon_color: "Custom"
                        on_release: root.on_discard_btn_clicked.invoke(root)
                    MDRectangleFlatButton:
                        text: app.bind_text(self, 'Save')
                        text_color: 0, 0, 1, 1
                        line_color: .2, 1, .7, 1
                        theme_icon_color: "Custom"
                        on_release: root.on_save_btn_clicked.invoke(root)

<StartScreen>:
    name: 'home'
    canvas:
        Color:
            rgba: .5, .5, .5, 1
        Rectangle:
            pos: self.center_x - .5, 0
            size: 1, self.height
    MDBoxLayout:
        AnchorLayout:
            BoxLayout:
                orientation: 'vertical'
                size_hint: .8, .4
                MDLabel:
                    id: title
                    markup: True
                    text: "[font=./data/fonts/Roboto-Thin]Welcome[/font]"
                    font_family: './data/fonts/Roboto-Thin.ttf'
                    font_size: '50'
                    color: 0, 0, 0, 1
                MDRectangleFlatButton:
                    text: app.bind_text(self, 'Connect to device')
                    theme_text_color: "Custom"
                    text_color: 1, 0, 0, 1
                    line_color: 0, 0, 1, 1
                    on_release: root.manager.current = 'connection'
        FitImage:
            source: './data/res/main.jpg'

<AppSettings>
    orientation: 'vertical'
    MDBoxLayout:
        orientation: 'vertical'
        spacing: 30
        MDBoxLayout:
            orientation: 'vertical'
            MDLabel:
                text: app.bind_text(self, 'APPEARANCE SETTINGS')
            MDBoxLayout:
                MDLabel:
                    text: app.bind_text(self, 'Language:')
                MenuDropDown:
                    id: language_drop_down
                    size_hint: .5, .5
                    pos_hint: {'y':.25}
                    size: caller_btn.width + 40, caller_btn.height
                    canvas.before:
                        Color:
                            rgba: .2, .1, 1, 1
                        Line:
                            width: .5
                            rectangle: self.x,self.y,self.width,self.height
                    Image:
                        id: caller_btn
                        size: 20, 20
                    MDLabel:
                        id: caller_label
                        text: app.configuration.config_dict['app']['current_language']
        MDBoxLayout:
            orientation: 'vertical'
            spacing: 20
            MDLabel:
                adaptive_height: True
                text: app.bind_text(self, 'MAP SETTINGS')
            MDRectangleFlatButton:
                text: app.bind_text(self, 'Clear cache')
                on_release: root.clear_cache()

<AppSettingsScreen>
    name: 'appSettings'
    app_settings: app_settings
    ScrollView:
        pos_hint: {'y': -.1}
        MDBoxLayout:
            size_hint_y: None
            height: dp(400)
            padding: 30
            spacing: 30
            orientation: 'vertical'
            AppSettings:
                id: app_settings
            MDBoxLayout:
                spacing: 10
                adaptive_height: True
                MDRectangleFlatButton:
                    text: app.bind_text(self, 'Discard')
                    text_color: 0, 0, 1, 1
                    line_color: 1, .2, .7, 1
                    theme_icon_color: "Custom"
                    on_release: root.discard_config()
                MDRectangleFlatButton:
                    text: app.bind_text(self, 'Save')
                    text_color: 0, 0, 1, 1
                    line_color: .2, 1, .7, 1
                    theme_icon_color: "Custom"
                    on_release: root.save_config()

<SupportScreen>:
    name: 'support'
    RelativeLayout:
        ScrollView:
            pos_hint: {'y': -.1}
            MDBoxLayout:
                padding: 20
                orientation: 'vertical'
                id: box
                adaptive_height: True

<ConnectionScreen>:
    name: 'connection'
    status: status_label

    MDBoxLayout:
        orientation: 'vertical'
        LoadingAnimation:
            id: loading_anim
            points_size: 20, 20
        MDLabel:
            size_hint_y: .3
            id: status_label
            halign: 'center'
            font_size: 20
            color: .5, .5, .8, 1

<ControlScreen>:
    name: 'control'
    RelativeLayout:
        MDAnchorLayout:
            anchor_x: 'left'
            anchor_y: 'top'
            MDBoxLayout:
                size_hint: .3, .4
                orientation: 'vertical'
                canvas.before:
                    Color:
                        rgba: .6, .1, .2, .6
                    Line:
                        width: 1
                        rectangle: self.x,self.y,self.width,self.height
                MapView:
                    id: mapview
                    lat: 52.533320
                    lon: 13.433042
                    zoom: 17
        MDBoxLayout:
            size_hint: .5, .15
            pos_hint: {'center_x': .5 , 'center_y': .9}
            MDBoxLayout:
                orientation: 'vertical'
                adaptive_width: True
                Image:
                    source: root.esp_connection_icon
                MDLabel:
                    halign: 'center'
                    text: root.altitude
                MDLabel:
                    halign: 'center'
                    text: root.speed
            MDCard:
                style: 'outlined'
                line_color: (0.2, 0.2, 0.2, 0.8)
                ScrollView:
                    MDBoxLayout:
                        padding: 10
                        id: terminal
                        adaptive_height: True
                        orientation: 'vertical'
            MDBoxLayout:
                adaptive_width: True
                orientation: 'vertical'
                MDLabel:
                    halign: 'center'
                    text: root.battery
                MDLabel:
                    halign: 'center'
                    text: root.latitude
                MDLabel:
                    halign: 'center'
                    text: root.longitude
        MDAnchorLayout:
            anchor_x: 'right'
            anchor_y: 'top'
            MDBoxLayout:
                adaptive_size: True
                orientation: 'vertical'
                padding: 20
                spacing: 10
                MDRectangleFlatIconButton:
                    text: app.bind_text(self, 'Add waypoint')
                    icon: 'map-marker-plus-outline'
                    on_release: root.set_waypoint()
                MDRectangleFlatIconButton:
                    id: hover_mode_btn
                    text: app.bind_text(self, 'Toggle hover')
                    icon: 'butterfly'
                    on_release: root.toggle_hover_mode()
                MDRectangleFlatIconButton:
                    text: app.bind_text(self, 'Menu')
                    icon: 'menu'
                    on_release: app.root_widget.show_nav_drawer()
        MDBoxLayout:
            id: joystick_a
            pos_hint: {'center_y': .3}
            orientation: 'horizontal'


<SettingsScreen>:
    app_settings: app_settings
    name: 'settings'
    ScrollView:
        MDBoxLayout:
            padding: 30
            spacing: 30
            orientation: 'vertical'
            size_hint_y: None
            height: dp(600)
            AppSettings:
                id: app_settings
            MDBoxLayout:
                spacing: 10
                adaptive_height: True
                MDRectangleFlatButton:
                    text: app.bind_text(self, 'Discard')
                    text_color: 0, 0, 1, 1
                    line_color: 1, .2, .7, 1
                    theme_icon_color: "Custom"
                    on_release: root.discard_config()
                MDRectangleFlatButton:
                    text: app.bind_text(self, 'Save', 'Save')
                    text_color: 0, 0, 1, 1
                    line_color: .2, 1, .7, 1
                    theme_icon_color: "Custom"
                    on_release: root.save_config()

<WaypointsScreen>:
    name: 'waypoints'
    MDAnchorLayout:
        canvas.before:
            Color:
                rgba: .5,.5,.5,1
            Line:
                width: 2
                rectangle: self.x,self.y,self.width,self.height
        anchor_y: 'bottom'
        padding: 30
        ScrollView:
            size_hint_y: .9
            MDGridLayout:
                size_hint_y: None
                id: grid
                spacing: 30, 30
    WaypointArea:
        id: edit_waypoint_area
    WaypointArea:
        id: add_waypoint_area

<WaypointCard>:
    style: 'elevated'
    line_color: (0.2, 0.2, 0.2, 0.8)
    RelativeLayout:
        MDBoxLayout:
            orientation: 'vertical'
            FitImage:
                id: image
                radius: 6, 6, 0, 0
                source: root.image_path
            MDBoxLayout:
                orientation: 'vertical'
                padding: 10
                spacing: 20
                MDLabel:
                    id: name_label
                    halign: 'center'
                    font_size: 14
                    text: root.name
                MDLabel:
                    id: altitude_label
                    font_size: 10
                    text: root.altitude
                MDLabel:
                    id: latitude_label
                    font_size: 10
                    text: root.latitude
                MDLabel:
                    id: longitude_label
                    font_size: 10
                    text: root.longitude
                MDLabel:
                    id: last_updated_label
                    font_size: 8
                    text: root.last_updated
        MDIconButton:
            id: drop_down
            icon: 'dots-vertical'
            size_hint: .2, .15
            pos_hint: {'x': .8, 'y': .8}
            on_release: root.open_menu()


<DroneRoot>:
    nav_drawer: nav_drawer
    nav_drawer_list: nav_drawer_content
    toolbar: toolbar

    BoxLayout:
        orientation: 'vertical'
        MyScreenManager:
            StartScreen
            AppSettingsScreen
            ConnectionScreen
            ControlScreen
            SettingsScreen
            WaypointsScreen
            SupportScreen
    MDToolbar:
        id: toolbar
        elevation: 10
        pos_hint: {'top': 1}
    MDNavigationDrawer:
        id: nav_drawer
        md_bg_color: get_color_from_hex("#f7f4e7")

        MDNavigationDrawerMenu:
            id: nav_drawer_content
            MDNavigationDrawerHeader:
                title: "MS Drone"
                text: app.bind_text(self, "By Monarch Softworks")
                spacing: "4dp"
                padding: "12dp", 0, 0, "56dp"
            MDNavigationDrawerDivider:
