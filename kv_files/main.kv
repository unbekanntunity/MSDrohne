#:kivy 2.0.0
#:import get_color_from_hex kivy.utils.get_color_from_hex

<RoundedButton@Button>:

<BouncingPoints>:

<LoadingAnimation>:
    Image:
        id: server_img
        source:'./data/res/server.png'
        pos_hint: {'center_x':.5, 'center_y': .4}
        size_hint: .4, .4
    Image:
        id: glass_img
        source:'./data/res/glass.png'
        pos_hint: {'center_x': .55, 'center_y': .5}
        size_hint: .1, .1
    BouncingPoints:
        id: bouncing_p
        size: 10, 10
        spacing_x: 50
        pos_hint: {'center_x': .38, 'center_y': .0}

<LanguageListItem>
    IconLeftWidget:
        icon: root.left_icon

<StartScreen>:
    name: 'start'
    canvas:
        Color:
            rgba: .5, .5, .5, 1
        Rectangle:
            pos: self.center_x - .5, 0
            size: 1, self.height
    BoxLayout:
        AnchorLayout:
            BoxLayout:
                orientation: 'vertical'
                size_hint: .8, .4
                MDLabel:
                    id: title
                    markup: True
                    text: "[font=./data/fonts/Roboto-Thin]Welcome[/font]"
                    font_family: './data/fonts/Roboto-Thin.ttf'
                    font_size: '50'
                    color: 0, 0, 0, 1
                MDRectangleFlatButton:
                    text: "Start"
                    theme_text_color: "Custom"
                    text_color: 1, 0, 0, 1
                    line_color: 0, 0, 1, 1
                    on_release: root.manager.current = 'connection'
        FitImage:
            source: './data/res/main.jpg'

<AppSettings>
    orientation: 'vertical'
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: None
        MDLabel:
            text: app.bind_text(self, 'TOUCH SETTINGS', 'TOUCH SETTINGS:')
        BoxLayout:
            MDLabel:
                text: 'Swipe-Sensitivity:'
            NumericTextInput:
                id: swipe_distance_text_input
                size_hint_x: .5
                pos_hint: {'y':.25}
    BoxLayout:
        size_hint_y: None
        canvas:
            Color:
                rgba: .5, .5, .5, .5
            Line:
                width: .5
                rectangle: self.x, self.y * 1.2, self.width, .5
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: None
        MDLabel:
            text: app.bind_text(self, 'APPEARANCE SETTINGS', 'APPEARANCE SETTINGS:')
        BoxLayout:
            MDLabel:
                text: 'Language:'
            LanguageDropDown:
                id: language_drop_down
                size_hint: .5, .5
                pos_hint: {'y':.25}
                size: caller_btn.width + 40, caller_btn.height
                canvas.before:
                    Color:
                        rgba: .2, .1, 1, 1
                    Line:
                        width: .5
                        rectangle: self.x,self.y,self.width,self.height
                Image:
                    id: caller_btn
                    size: 20, 20
                MDLabel:
                    id: caller_label
                    text: app.configuration.config_dict['app']['current_language']

<AppSettingsScreen>
    name: 'appSettings'
    app_settings: app_settings
    MDBoxLayout:
        padding: 30
        spacing: 30
        orientation: 'vertical'
        pos_hint: {'center_y': .7}
        AppSettings:
            id: app_settings
        MDBoxLayout:
            spacing: 10
            adaptive_height: True
            MDRectangleFlatButton:
                text: app.bind_text(self, 'Discard', 'Discard')
                text_color: 0, 0, 1, 1
                line_color: 1, .2, .7, 1
                theme_icon_color: "Custom"
            MDRectangleFlatButton:
                text: app.bind_text(self, 'Save', 'Save')
                text_color: 0, 0, 1, 1
                line_color: .2, 1, .7, 1
                theme_icon_color: "Custom"
                on_release: root.save_config()

<SupportScreen>:
    name: 'support'
    AnchorLayout:
        padding: 20
        anchor_x: 'left'
        anchor_y: 'top'
        RoundedButton:
            size_hint_x: None
            size_hint_y: None
            text: app.bind_text(self, 'Return', 'Return')
            on_release: root.go_back('start')
    AnchorLayout:
        ScrollView:
            size_hint_x: 0.75
            size_hint_y: 0.8
            orientation: 'vertical'
            padding: 20
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height
            BoxLayout:
                id: question_box
                padding: 20
                size_hint_y: None
                orientation: 'vertical'

<ConnectionScreen>:
    name: 'connection'
    status: status_label

    BoxLayout:
        orientation: 'vertical'
        LoadingAnimation:
            id: loading_anim
            points_size: 20, 20
        MDLabel:
            size_hint_y: .4
            id: status_label
            halign: 'center'
            font_size: 20
            color: .5, .5, .8, 1


<ControlScreen>:
    name: 'control'
    AnchorLayout:
        anchor_y: 'top'
        BoxLayout:
            id: top_a
            spacing: 30
            size_hint_y: None
            height: root.height / 6
            RoundedButton:
                id: back_btn
                text: app.bind_text(self, 'Return', 'Return')
                on_press: root.go_back('start')
            Label:
                text: root.status
            RoundedButton:
                text: app.bind_text(self, 'Menu', 'Menu')
                on_press: root.manager.current = 'settings'
    AnchorLayout:
        pos: 0, -100
        padding: 20
        anchor_x: 'right'
        anchor_y: 'top'
        orientation: 'horizontal'
        RoundedButton:
            size_hint_x: None
            size_hint_y: None
            text: 'set'
            on_release: root.set_waypoint()
    BoxLayout:
        pos: 0, -100
        id: joystick_a
        orientation: 'horizontal'
    AnchorLayout:
        anchor_y: 'bottom'
        BoxLayout:
            size_hint_y: None
            height: root.height / 6
            Label:
                text: f'H: {root.altitude} \nS: {root.speed}'
            Label:
                text: f'Lo: {root.latitude} \nLa: {root.longitude}'
            Label:
                text: f'{root.battery}%'
            Label:
                text: f'{root.esp_connection}'

<SettingsScreen>:
    app_settings: app_settings
    name: 'settings'
    AnchorLayout:
        padding: 20
        anchor_x: 'left'
        anchor_y: 'top'
        RoundedButton:
            size_hint_x: None
            size_hint_y: None
            text: 'back'
            on_release: root.close_menu()
    AnchorLayout:
        ScrollView:
            size_hint_x: 0.75
            size_hint_y: 0.6
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: 800
                padding: 20
                spacing: 20
                Label:
                    text: app.bind_text(self, 'Settings', 'Settings')
                BoxLayout:
                    Label:
                        text: app.bind_text(self, 'Ticks', 'Ticks:')
                    NumericTextInput:
                        id: tick_field
                        filter_type: 'int'
                        multiline: False
                AppSettings:
                    id: app_settings
                AnchorLayout:
                    anchor_x: 'center'
                    anchor_y: 'center'
                    Button:
                        size_hint: (.5, .3)
                        text: app.bind_text(self, 'Save', 'Save')
                        on_release: root.save_config()

<WaypointsScreen>:
    name: 'waypoints'
    AnchorLayout:
        padding: 20
        anchor_x: 'left'
        anchor_y: 'top'
        RoundedButton:
            size_hint_x: None
            size_hint_y: None
            text: 'back'
            on_release: root.close_menu()
    AnchorLayout:
        anchor_x: 'center'
        anchor_y: 'top'
        FloatLayout:
            size_hint_y: .2
            Label:
                pos_hint: {'x':  .45, 'y': 0}
                size_hint: (None, None)
                text: app.bind_text(self, 'Waypoints', 'Waypoints')
                font_size: 50
            RoundedButton:
                pos_hint: {'x':  .8, 'y': .25}
                size_hint: (None, .5)
                text: 'clear'
                on_release: root.go_back_to_menu()
    AnchorLayout:
        anchor_y: 'bottom'
        size_hint_y: 0.8
        canvas.before:
            Color:
                rgba: 1, 1, 1, 1
            Line:
                width: 1
                rectangle: self.x, self.y, self.width, self.height
        ScrollView:
            BoxLayout:
                id: list_area
                orientation: 'vertical'
                size_hint_y: None
                height: root.get_height()


<DroneRoot>:
    nav_drawer: nav_drawer
    nav_drawer_list: nav_drawer_content

    canvas.before:
		Color:
			rgba: 1, 1, 1, 1
		Rectangle:
			pos: self.pos
			size: self.size
    BoxLayout:
        orientation: 'vertical'
        MyScreenManager:
            StartScreen
            AppSettingsScreen
            ConnectionScreen
            ControlScreen
            SettingsScreen
            WaypointsScreen
            SupportScreen
        BoxLayout:
            id: nav_bar
            size_hint_y: None
            height: 0
    MDToolbar:
        id: toolbar
        title: "Example Banners"
        elevation: 10
        pos_hint: {'top': 1}
    MDNavigationDrawer:
        id: nav_drawer
        md_bg_color: get_color_from_hex("#f7f4e7")

        MDNavigationDrawerMenu:
            id: nav_drawer_content
            MDNavigationDrawerHeader:
                title: "Header title"
                text: "Header text"
                spacing: "4dp"
                padding: "12dp", 0, 0, "56dp"
            MDNavigationDrawerDivider:
